// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ProductionOrder {
  id                 String       @id @default(cuid())
  customerName       String       // 客戶名稱
  productName        String       @default("未命名產品") // 產品名字
  productionQuantity Int          // 生產數量
  unitWeightMg       Float        // 單粒總重量（計算）
  batchTotalWeightMg Float        // 批次總重量（計算）
  completionDate     DateTime?    // 完工日期
  processIssues      String?      // 製程問題記錄
  qualityNotes       String?      // 品管備註
  capsuleColor       String?      // 膠囊顏色
  capsuleSize        String?      // 膠囊大小 (#1, #0, #00)
  capsuleType        String?      // 膠囊成份 (明膠胃溶, 植物胃溶, 明膠腸溶, 植物腸溶)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  createdBy          String?      // 建檔人員
  ingredients        Ingredient[]

  @@map("production_orders")
}

model Ingredient {
  id            String          @id @default(cuid())
  orderId       String
  materialName  String          // 原料品名
  unitContentMg Float           // 單粒含量
  isCustomerProvided Boolean    @default(true) // 是否為客戶指定原料
  order         ProductionOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("ingredients")
}

// ===== v2.0 新增模型 =====

model AIRecipe {
  id               String    @id @default(cuid())
  name             String    // 配方名稱
  description      String?   // 配方描述
  targetEffect     String    // 目標功效
  targetAudience   String?   // 目標受眾
  dosageForm       String    @default("capsule") // 劑型 (capsule, tablet, powder)
  ingredients      String    // 原料列表 (JSON as String)
  dosage           String    // 劑量信息 (JSON as String)
  efficacyScore    Float?    // 功效評分 (0-10)
  safetyScore      Float?    // 安全性評分 (0-10)
  costAnalysis     String?   // 成本分析 (JSON as String)
  regulatoryStatus String?   // 法規狀態
  isActive         Boolean   @default(true)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  @@map("ai_recipes")
}

model IngredientPrice {
  id           String    @id @default(cuid())
  materialName String    // 原料名稱
  supplier     String    // 供應商
  price        Float     // 價格
  currency     String    @default("HKD") // 貨幣
  unit         String    @default("kg") // 單位
  minimumOrder Float?    // 最小訂購量
  leadTime     String?   // 交貨期
  quality      String    @default("A") // 質量等級 (A, B, C)
  source       String?   // 數據來源
  validFrom    DateTime  @default(now()) // 有效期開始
  validTo      DateTime? // 有效期結束
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  @@map("ingredient_prices")
}

model ProductEfficacy {
  id                String    @id @default(cuid())
  ingredientName    String    // 原料名稱
  effect            String    // 功效
  evidenceLevel     String    // 證據等級 (A, B, C, D)
  dosage            Float     // 劑量
  scientificBasis   String?   // 科學依據
  clinicalTrials    String?   // 臨床試驗數據 (JSON as String)
  safetyProfile     String?   // 安全性檔案 (JSON as String)
  interactions      String?   // 相互作用 (JSON as String)
  contraindications String?   // 禁忌症 (JSON as String)
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@map("product_efficacy")
}

model WorkOrder {
  id                     String    @id @default(cuid())
  orderId                String    // 關聯的訂單ID
  orderNumber            String    // 工作單號
  productName            String    // 產品名稱
  batchSize              Int       // 批次大小
  productionSteps        String    // 生產步驟 (JSON as String)
  qualityControlPoints   String    // 質量控制點 (JSON as String)
  riskAssessment         String?   // 風險評估 (JSON as String)
  isoCompliant           Boolean   @default(true) // ISO 合規
  isoStandard            String    @default("ISO 9001") // ISO 標準
  status                 String    @default("draft") // 狀態 (draft, approved, in_progress, completed)
  approvedBy             String?   // 批准人
  approvedAt             DateTime? // 批准時間
  generatedAt            DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  @@map("work_orders")
}

model QCFile {
  id                   String    @id @default(cuid())
  workOrderId          String    // 關聯的工作單ID
  testMethods          String    // 測試方法 (JSON as String)
  acceptanceCriteria   String    // 接受標準 (JSON as String)
  inspectionRecords    String?   // 檢驗記錄 (JSON as String)
  isoStandard          String    @default("ISO 9001") // ISO 標準
  testResults          String?   // 測試結果 (JSON as String)
  inspector            String?   // 檢驗員
  inspectedAt          DateTime? // 檢驗時間
  status               String    @default("pending") // 狀態 (pending, in_progress, completed, failed)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  
  @@map("qc_files")
}

model ProductDatabase {
  id                String    @id @default(cuid())
  productName       String    // 產品名稱
  category          String?   // 分類
  formula           String    // 配方 (JSON as String)
  efficacy          String?   // 功效 (JSON as String)
  safety            String?   // 安全性 (JSON as String)
  regulatoryStatus  String?   // 法規狀態 (JSON as String)
  version           String    @default("1.0") // 版本
  isActive          Boolean   @default(true)
  tags              String?   // 標籤 (JSON as String)
  notes             String?   // 備註
  createdBy         String?   // 創建者
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@map("product_database")
}

model AdCopy {
  id                    String    @id @default(cuid())
  productId             String?   // 關聯的產品ID
  targetMarket          String    // 目標市場
  language              String    @default("zh-TW") // 語言
  copyType              String    // 廣告詞類型 (headline, description, benefit, warning)
  content               String    // 廣告詞內容
  regulatoryCompliant   Boolean   @default(false) // 法規合規
  evidenceBased         Boolean   @default(false) // 基於證據
  aiGenerated           Boolean   @default(true) // AI 生成
  version               String    @default("1.0") // 版本
  isActive              Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  @@map("ad_copies")
}
